module.exports=[10547,e=>{"use strict";e.s(["lmsContentService",()=>g],10547);var t=e.i(52374),s=e.i(85348),r=e.i(99755),n=e.i(66685);let o=e=>({id:e.id,courseId:e.courseId,sectionKey:e.sectionKey,title:e.title,orderIndex:e.orderIndex,iconName:e.iconName,isPublished:e.isPublished,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}),i=e=>({id:e.id,sectionId:e.sectionId,blockType:e.blockType,orderIndex:e.orderIndex,content:e.content,metadata:e.metadata,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}),c=e=>({id:e.id,sectionId:e.sectionId,questionKey:e.questionKey,questionType:e.questionType,questionText:e.questionText,options:e.options,correctAnswer:e.correctAnswer,explanation:e.explanation,orderIndex:e.orderIndex,isPublished:e.isPublished,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}),a=(e,t,s)=>s?"safety_admin"===t||"plant_manager"===t?{hasAccess:!0,section:o(e),permissions:{canView:!0,canEdit:!0,canDelete:!0,canManageContent:!0}}:"safety_instructor"===t?{hasAccess:!0,section:o(e),permissions:{canView:!0,canEdit:!0,canDelete:!1,canManageContent:!0}}:"hr_admin"===t?{hasAccess:!0,section:o(e),permissions:{canView:!0,canEdit:!1,canDelete:!1,canManageContent:!0}}:"employee"===t?{hasAccess:e.isPublished,section:e.isPublished?o(e):void 0,permissions:{canView:e.isPublished,canEdit:!1,canDelete:!1,canManageContent:!1}}:{hasAccess:!1,reason:"User does not have access to this section"}:{hasAccess:!1,reason:"User does not have access to the course"},d=e=>({id:e.id,sectionId:e.sectionId,questionKey:e.questionKey,questionType:e.questionType,questionText:e.questionText,options:e.options,correctAnswer:e.correctAnswer,explanation:e.explanation,orderIndex:e.orderIndex,isPublished:e.isPublished,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}),u=async(e,s,r="employee")=>{try{if("employee"===r)return{success:!1,error:{code:"USER_NOT_AUTHORIZED",message:"Insufficient permissions",timestamp:new Date().toISOString()},version:"1.0"};if(!await (0,t.isSectionKeyUnique)(e,s.sectionKey))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Section key must be unique within the course",timestamp:new Date().toISOString()},version:"1.0"};s.orderIndex??await (0,t.getNextSectionOrderIndex)(e);let n=((e,t)=>({courseId:t,sectionKey:e.sectionKey,title:e.title,orderIndex:e.orderIndex,iconName:e.iconName,isPublished:e.isPublished}))(s,e),i=await (0,t.createCourseSection)(n);return{success:!0,data:o(i),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},m=async(e,s,r="employee")=>{try{let n=await (0,t.getCourseSectionById)(e);if(!n)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Section not found",timestamp:new Date().toISOString()},version:"1.0"};let i=a(n,r,!0);if(!i.hasAccess||!i.permissions?.canEdit)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:i.reason||"Access denied",timestamp:new Date().toISOString()},version:"1.0"};if(s.sectionKey&&s.sectionKey!==n.sectionKey&&!await (0,t.isSectionKeyUnique)(n.courseId,s.sectionKey,e))return{success:!1,error:{code:"VALIDATION_ERROR",message:"Section key must be unique within the course",timestamp:new Date().toISOString()},version:"1.0"};let c=((e,t)=>({...t,sectionKey:e.sectionKey??t.sectionKey,title:e.title??t.title,orderIndex:e.orderIndex??t.orderIndex,iconName:e.iconName??t.iconName,isPublished:e.isPublished??t.isPublished,updatedAt:new Date}))(s,n),d=await (0,t.updateCourseSection)(e,c);if(!d)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Failed to update section",timestamp:new Date().toISOString()},version:"1.0"};return{success:!0,data:o(d),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},S=async(e,s="employee")=>{try{let r=await (0,t.getCourseSectionById)(e);if(!r)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Section not found",timestamp:new Date().toISOString()},version:"1.0"};let n=a(r,s,!0);if(!n.hasAccess||!n.permissions?.canDelete)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:n.reason||"Access denied",timestamp:new Date().toISOString()},version:"1.0"};if(!await (0,t.deleteCourseSection)(e))return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Failed to delete section",timestamp:new Date().toISOString()},version:"1.0"};return{success:!0,message:"Section deleted successfully",version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},l=async(e,r,n="employee")=>{try{if("employee"===n)return{success:!1,error:{code:"USER_NOT_AUTHORIZED",message:"Insufficient permissions",timestamp:new Date().toISOString()},version:"1.0"};let o=await (0,t.getCourseSectionById)(e);if(!o)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Section not found",timestamp:new Date().toISOString()},version:"1.0"};let i=a(o,n,!0);if(!i.hasAccess||!i.permissions?.canEdit)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:i.reason||"Access denied",timestamp:new Date().toISOString()},version:"1.0"};let c=await (0,s.validateContentBlockContent)(r.blockType,r.content);if(!c.isValid)return{success:!1,error:{code:"VALIDATION_ERROR",message:c.errors.join(", "),timestamp:new Date().toISOString()},version:"1.0"};r.orderIndex??await (0,s.getNextContentBlockOrderIndex)(e);let d=((e,t)=>({sectionId:t,blockType:e.blockType,orderIndex:e.orderIndex,content:e.content,metadata:e.metadata}))(r,e),u=await (0,s.createContentBlock)(d);return{success:!0,data:(e=>({id:e.id,sectionId:e.sectionId,blockType:e.blockType,orderIndex:e.orderIndex,content:e.content,metadata:e.metadata,createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}))(u),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},p=async(e,t,s="employee")=>{try{let r;if("employee"===s)return{success:!1,error:{code:"USER_NOT_AUTHORIZED",message:"Insufficient permissions",timestamp:new Date().toISOString()},version:"1.0"};let o=await (0,n.getUserProgressByUserAndSection)(e,t.sectionId);if(o){let s=((e,t,s)=>{let r=new Date;return{...s,userId:t,courseId:e.courseId,sectionId:e.sectionId,isCompleted:e.isCompleted??s?.isCompleted??!1,completionPercentage:e.completionPercentage??s?.completionPercentage??0,timeSpentSeconds:e.timeSpentSeconds??s?.timeSpentSeconds??0,lastAccessedAt:r,completedAt:e.isCompleted?r:s?.completedAt,updatedAt:r}})(t,e,o);r=await (0,n.updateUserProgressByUserAndSection)(e,t.sectionId,s)}else{let s=((e,t)=>{let s=new Date;return{userId:t,courseId:e.courseId,sectionId:e.sectionId,isCompleted:e.isCompleted??!1,completionPercentage:e.completionPercentage??0,timeSpentSeconds:e.timeSpentSeconds??0,lastAccessedAt:s,completedAt:e.isCompleted?s:void 0}})(t,e);r=await (0,n.upsertUserProgress)(s)}if(!r)return{success:!1,error:{code:"PROGRESS_UPDATE_FAILED",message:"Failed to update progress",timestamp:new Date().toISOString()},version:"1.0"};return{success:!0,data:(e=>({id:e.id,userId:e.userId,courseId:e.courseId,sectionId:e.sectionId,isCompleted:e.isCompleted,completionPercentage:e.completionPercentage,timeSpentSeconds:e.timeSpentSeconds,lastAccessedAt:e.lastAccessedAt.toISOString(),completedAt:e.completedAt?.toISOString(),createdAt:e.createdAt.toISOString(),updatedAt:e.updatedAt.toISOString()}))(r),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},g={getCourseSections:async e=>({success:!0,data:[],pagination:{page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrev:!1}}),createCourseSection:async e=>u("",e),updateCourseSection:async(e,t)=>m(e,t),deleteCourseSection:async e=>S(e),getContentBlocks:async e=>({success:!0,data:[],pagination:{page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrev:!1}}),createContentBlock:async e=>l("",e),updateContentBlock:async(e,t)=>({success:!0,data:{}}),deleteContentBlock:async e=>({success:!0,message:"Content block deleted"}),getQuizQuestions:async e=>{try{let{pagination:t,sectionId:s}=e;if(!s)return{success:!1,error:"Section ID is required",data:[],pagination:{page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrev:!1}};let n=await (0,r.getQuizQuestionsBySectionId)(s,{includeUnpublished:!1,sortBy:"orderIndex",sortOrder:"asc"}),o=n.length,i=Math.ceil(o/t.limit),c=(t.page-1)*t.limit,a=n.slice(c,c+t.limit);return{success:!0,data:a,pagination:{page:t.page,limit:t.limit,total:o,totalPages:i,hasNext:t.page<i,hasPrev:t.page>1}}}catch(e){return console.error("Error in getQuizQuestions service:",e),{success:!1,error:"Failed to fetch quiz questions",data:[],pagination:{page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrev:!1}}}},createQuizQuestion:async e=>({success:!0,data:{}}),updateQuizQuestion:async(e,t)=>({success:!0,data:{}}),deleteQuizQuestion:async e=>({success:!0,message:"Quiz question deleted"}),getUserProgress:async e=>({success:!0,data:[],pagination:{page:1,limit:20,total:0,totalPages:0,hasNext:!1,hasPrev:!1}}),createUserProgress:async e=>p("",e),updateUserProgress:async(e,t)=>p("",t),deleteUserProgress:async e=>({success:!0,message:"User progress deleted"}),getCourseContent:async(e,s="en",r=!1,n="employee")=>{try{let s=await (0,t.getAccessibleCourseSections)(e,n,{includeUnpublished:r});return{success:!0,data:{course:{id:e,courseKey:e,title:"Function-Specific HazMat Training",description:"Handling, Packaging, and Shipping DOT-Regulated Materials",version:"1.0",isPublished:!0},sections:s.map(o)},version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},getSectionContent:async(e,s,r="en",n=!1,d="employee")=>{try{let r,n,u,m=await (0,t.getCourseSectionByKey)(e,s);if(!m)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Section not found",timestamp:new Date().toISOString()},version:"1.0"};let S=a(m,d,!0);if(!S.hasAccess)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:S.reason||"Access denied",timestamp:new Date().toISOString()},version:"1.0"};let l=await (0,t.getCourseSectionWithContent)(m.id);if(!l)return{success:!1,error:{code:"COURSE_SECTION_NOT_FOUND",message:"Section content not found",timestamp:new Date().toISOString()},version:"1.0"};return{success:!0,data:(r=l.section,n=l.contentBlocks,u=l.quizQuestions,{section:o(r),contentBlocks:n.map(i),quizQuestions:u.map(c)}),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},submitQuizAnswer:async(e,t,s,n="employee")=>{try{let o=await (0,r.getQuizQuestionById)(e);if(!o)return{success:!1,error:{code:"QUIZ_QUESTION_NOT_FOUND",message:"Quiz question not found",timestamp:new Date().toISOString()},version:"1.0"};let i=((e,t,s)=>s?"safety_admin"===t||"plant_manager"===t?{hasAccess:!0,question:d(e),permissions:{canView:!0,canEdit:!0,canDelete:!0,canSubmitAnswer:!0}}:"safety_instructor"===t?{hasAccess:!0,question:d(e),permissions:{canView:!0,canEdit:!0,canDelete:!1,canSubmitAnswer:!0}}:"hr_admin"===t?{hasAccess:!0,question:d(e),permissions:{canView:!0,canEdit:!1,canDelete:!1,canSubmitAnswer:!0}}:"employee"===t?{hasAccess:e.isPublished,question:e.isPublished?d(e):void 0,permissions:{canView:e.isPublished,canEdit:!1,canDelete:!1,canSubmitAnswer:e.isPublished}}:{hasAccess:!1,reason:"User does not have access to this quiz question"}:{hasAccess:!1,reason:"User does not have access to the section"})(o,n,!0);if(!i.hasAccess||!i.permissions?.canSubmitAnswer)return{success:!1,error:{code:"QUIZ_QUESTION_NOT_FOUND",message:i.reason||"Access denied",timestamp:new Date().toISOString()},version:"1.0"};let c=((e,t)=>{let s=[];switch(e.questionType){case"true-false":"boolean"!=typeof t&&s.push("True/false questions require a boolean answer");break;case"multiple-choice":"string"!=typeof t?s.push("Multiple choice questions require a string answer"):!e.options||t in e.options||s.push("Answer must be one of the provided options")}return s.length>0?{isValid:!1,isCorrect:!1,errors:s}:{isValid:!0,isCorrect:t===e.correctAnswer,errors:[],explanation:e.explanation}})(o,t.userAnswer);if(!c.isValid)return{success:!1,error:{code:"INVALID_QUIZ_ANSWER",message:c.errors.join(", "),timestamp:new Date().toISOString()},version:"1.0"};let a=((e,t,s)=>({userId:t,quizQuestionId:e.quizQuestionId,userAnswer:e.userAnswer,isCorrect:s,timeSpentSeconds:e.timeSpentSeconds,attemptedAt:new Date}))(t,s,c.isCorrect),u=await (0,r.createQuizAttempt)(a);return{success:!0,data:(e=>({id:e.id,userId:e.userId,quizQuestionId:e.quizQuestionId,userAnswer:e.userAnswer,isCorrect:e.isCorrect,attemptedAt:e.attemptedAt.toISOString(),timeSpentSeconds:e.timeSpentSeconds}))(u),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}},getCourseCompletionStatus:async(e,t,s="employee")=>{try{if(!await (0,n.canUserAccessProgress)("",e,s))return{success:!1,error:{code:"USER_NOT_AUTHORIZED",message:"Access denied",timestamp:new Date().toISOString()},version:"1.0"};let r=await (0,n.calculateCourseCompletionStatus)(e,t);if(!r)return{success:!1,error:{code:"COURSE_NOT_FOUND",message:"Course not found",timestamp:new Date().toISOString()},version:"1.0"};return{success:!0,data:(e=>({courseId:e.courseId,userId:e.userId,totalSections:e.totalSections,completedSections:e.completedSections,completionPercentage:e.completionPercentage,timeSpentSeconds:e.timeSpentSeconds,lastAccessedAt:e.lastAccessedAt.toISOString(),completedAt:e.completedAt?.toISOString()}))(r),version:"1.0"}}catch(e){return{success:!1,error:{code:"SYSTEM_ERROR",message:"Internal server error",timestamp:new Date().toISOString()},version:"1.0"}}}}}];

//# sourceMappingURL=apps_safety-lms_src_lib_services_lms-content-service_ts_1bcd5f19._.js.map