module.exports=[46786,(e,t,i)=>{t.exports=e.x("os",()=>require("os"))},22734,(e,t,i)=>{t.exports=e.x("fs",()=>require("fs"))},4446,(e,t,i)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,i)=>{t.exports=e.x("tls",()=>require("tls"))},54799,(e,t,i)=>{t.exports=e.x("crypto",()=>require("crypto"))},60438,(e,t,i)=>{t.exports=e.x("perf_hooks",()=>require("perf_hooks"))},89726,e=>{"use strict";e.s(["db",()=>tV],89726);var t=e.i(46786),i=e.i(22734);let s=new Map,r=new Map,n=Symbol("OriginError"),a={};class l extends Promise{constructor(e,t,i,r,a={}){let l,o;super((e,t)=>{l=e,o=t}),this.tagged=Array.isArray(e.raw),this.strings=e,this.args=t,this.handler=i,this.canceller=r,this.options=a,this.state=null,this.statement=null,this.resolve=e=>(this.active=!1,l(e)),this.reject=e=>(this.active=!1,o(e)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[n]=this.handler.debug?Error():this.tagged&&function(e){if(s.has(e))return s.get(e);let t=Error.stackTraceLimit;return Error.stackTraceLimit=4,s.set(e,Error()),Error.stackTraceLimit=t,s.get(e)}(this.strings)}get origin(){return(this.handler.debug?this[n].stack:this.tagged&&r.has(this.strings)?r.get(this.strings):r.set(this.strings,this[n].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(e=1,t){let i;return(this.options.simple=!1,"function"==typeof e&&(t=e,e=1),this.cursorRows=e,"function"==typeof t)?(this.cursorFn=t,this):{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};i&&i();let e=new Promise((e,t)=>{this.cursorFn=t=>(e({value:t,done:!1}),new Promise(e=>i=e)),this.resolve=()=>(this.active=!1,e({done:!0})),this.reject=e=>(this.active=!1,t(e))});return this.execute(),e},return:()=>(i&&i(a),{done:!0})})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(e){return this.forEachFn=e,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}class o extends Error{constructor(e){super(e.message),this.name=this.constructor.name,Object.assign(this,e)}}let c={connection:function e(t,i,s){let{host:r,port:n}=s||i,a=Object.assign(Error("write "+t+" "+(i.path||r+":"+n)),{code:t,errno:t,address:i.path||r},i.path?{}:{port:n});return Error.captureStackTrace(a,e),a},postgres:function e(t){let i=new o(t);return Error.captureStackTrace(i,e),i},generic:function e(t,i){let s=Object.assign(Error(t+": "+i),{code:t});return Error.captureStackTrace(s,e),s},notSupported:function e(t){let i=Object.assign(Error(t+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:t});return Error.captureStackTrace(i,e),i}};class u{then(){T()}catch(){T()}finally(){T()}}class h extends u{constructor(e){super(),this.value=P(e)}}class d extends u{constructor(e,t,i){super(),this.value=e,this.type=t,this.array=i}}class f extends u{constructor(e,t){super(),this.first=e,this.rest=t}build(e,t,i,s){let r=q.map(([t,i])=>({fn:i,i:e.search(t)})).sort((e,t)=>e.i-t.i).pop();return -1===r.i?A(this.first,s):r.fn(this.first,this.rest,t,i,s)}}function p(e,t,i,s){let r=e instanceof d?e.value:e;if(void 0===r&&(e instanceof d?e.value=s.transform.undefined:r=e=s.transform.undefined,void 0===r))throw c.generic("UNDEFINED_VALUE","Undefined values are not allowed");return"$"+i.push(e instanceof d?(t.push(e.value),e.array?e.array[e.type||x(e.value)]||e.type||function e(t){return Array.isArray(t)?e(t[0]):1009*("string"==typeof t)}(e.value):e.type):(t.push(e),x(e)))}let g=_({string:{to:25,from:null,serialize:e=>""+e},number:{to:0,from:[21,23,26,700,701],serialize:e=>""+e,parse:e=>+e},json:{to:114,from:[114,3802],serialize:e=>JSON.stringify(e),parse:e=>JSON.parse(e)},boolean:{to:16,from:16,serialize:e=>!0===e?"t":"f",parse:e=>"t"===e},date:{to:1184,from:[1082,1114,1184],serialize:e=>(e instanceof Date?e:new Date(e)).toISOString(),parse:e=>new Date(e)},bytea:{to:17,from:17,serialize:e=>"\\x"+Buffer.from(e).toString("hex"),parse:e=>Buffer.from(e.slice(2),"hex")}});function m(e,t,i,s,r,n){for(let a=1;a<e.strings.length;a++)t+=y(t,i,s,r,n)+e.strings[a],i=e.args[a];return t}function y(e,t,i,s,r){return t instanceof f?t.build(e,i,s,r):t instanceof l?b(t,i,s,r):t instanceof h?t.value:t&&t[0]instanceof l?t.reduce((e,t)=>e+" "+b(t,i,s,r),""):p(t,i,s,r)}function b(e,t,i,s){return e.fragment=!0,m(e,e.strings[0],e.args[0],t,i,s)}function w(e,t,i,s,r){return e.map(e=>"("+s.map(s=>y("values",e[s],t,i,r)).join(",")+")").join(",")}function v(e,t,i,s,r){let n=Array.isArray(e[0]),a=t.length?t.flat():Object.keys(n?e[0]:e);return w(n?e:[e],i,s,a,r)}function S(e,t,i,s,r){let n;return("string"==typeof e&&(e=[e].concat(t)),Array.isArray(e))?A(e,r):(t.length?t.flat():Object.keys(e)).map(t=>((n=e[t])instanceof l?b(n,i,s,r):n instanceof h?n.value:p(n,i,s,r))+" as "+P(r.transform.column.to?r.transform.column.to(t):t)).join(",")}let q=Object.entries({values:v,in:(...e)=>{let t=v(...e);return"()"===t?"(null)":t},select:S,as:S,returning:S,"\\(":S,update:(e,t,i,s,r)=>(t.length?t.flat():Object.keys(e)).map(t=>P(r.transform.column.to?r.transform.column.to(t):t)+"="+y("values",e[t],i,s,r)),insert(e,t,i,s,r){let n=t.length?t.flat():Object.keys(Array.isArray(e)?e[0]:e);return"("+A(n,r)+")values"+w(Array.isArray(e)?e:[e],i,s,n,r)}}).map(([e,t])=>[RegExp("((?:^|[\\s(])"+e+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),t]);function T(){throw c.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}let N=g.serializers,C=g.parsers,$=function(e){let t=_(e||{});return{serializers:Object.assign({},N,t.serializers),parsers:Object.assign({},C,t.parsers)}};function _(e){return Object.keys(e).reduce((t,i)=>(e[i].from&&[].concat(e[i].from).forEach(s=>t.parsers[s]=e[i].parse),e[i].serialize&&(t.serializers[e[i].to]=e[i].serialize,e[i].from&&[].concat(e[i].from).forEach(s=>t.serializers[s]=e[i].serialize)),t),{parsers:{},serializers:{}})}function A(e,{transform:{column:t}}){return e.map(e=>P(t.to?t.to(e):e)).join(",")}let P=function(e){return'"'+e.replace(/"/g,'""').replace(/\./g,'"."')+'"'},x=function e(t){return t instanceof d?t.type:t instanceof Date?1184:t instanceof Uint8Array?17:!0===t||!1===t?16:"bigint"==typeof t?20:Array.isArray(t)?e(t[0]):0},E=/\\/g,O=/"/g,B=function e(t,i,s,r){if(!1===Array.isArray(t))return t;if(!t.length)return"{}";let n=t[0],a=1020===r?";":",";return Array.isArray(n)&&!n.type?"{"+t.map(t=>e(t,i,s,r)).join(a)+"}":"{"+t.map(e=>{if(void 0===e&&void 0===(e=s.transform.undefined))throw c.generic("UNDEFINED_VALUE","Undefined values are not allowed");return null===e?"null":'"'+(i?i(e.type?e.value:e):""+e).replace(E,"\\\\").replace(O,'\\"')+'"'}).join(a)+"}"},j={i:0,char:null,str:"",quoted:!1,last:0},k=e=>{let t=e[0];for(let i=1;i<e.length;i++)t+="_"===e[i]?e[++i].toUpperCase():e[i];return t},Q=e=>{let t=e[0].toUpperCase();for(let i=1;i<e.length;i++)t+="_"===e[i]?e[++i].toUpperCase():e[i];return t},L=e=>e.replace(/_/g,"-"),z=e=>e.replace(/([A-Z])/g,"_$1").toLowerCase(),M=e=>(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),F=e=>e.replace(/-/g,"_");function D(e){return function t(i,s){return"object"==typeof i&&null!==i&&(114===s.type||3802===s.type)?Array.isArray(i)?i.map(e=>t(e,s)):Object.entries(i).reduce((i,[r,n])=>Object.assign(i,{[e(r)]:t(n,s)}),{}):i}}k.column={from:k},k.value={from:D(k)},z.column={to:z};let I={...k};I.column.to=z,Q.column={from:Q},Q.value={from:D(Q)},M.column={to:M};let U={...Q};U.column.to=M,L.column={from:L},L.value={from:D(L)},F.column={to:F};let R={...L};R.column.to=F;var K=e.i(4446),J=e.i(55004),V=e.i(54799),W=e.i(88947),G=e.i(60438);class H extends Array{constructor(){super(),Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}let Y=function(e=[]){let t=e.slice(),i=0;return{get length(){return t.length-i},remove:e=>{let i=t.indexOf(e);return -1===i?null:(t.splice(i,1),e)},push:e=>(t.push(e),e),shift:()=>{let e=t[i++];return i===t.length?(i=0,t=[]):t[i-1]=void 0,e}}},X=Buffer.allocUnsafe(256),Z=Object.assign(function(){return Z.i=0,Z},"BCcDdEFfHPpQSX".split("").reduce((e,t)=>{let i=t.charCodeAt(0);return e[t]=()=>(X[0]=i,Z.i=5,Z),e},{}),{N:"\0",i:0,inc:e=>(Z.i+=e,Z),str(e){let t=Buffer.byteLength(e);return ee(t),Z.i+=X.write(e,Z.i,t,"utf8"),Z},i16:e=>(ee(2),X.writeUInt16BE(e,Z.i),Z.i+=2,Z),i32:(e,t)=>(t||0===t?X.writeUInt32BE(e,t):(ee(4),X.writeUInt32BE(e,Z.i),Z.i+=4),Z),z:e=>(ee(e),X.fill(0,Z.i,Z.i+e),Z.i+=e,Z),raw:e=>(X=Buffer.concat([X.subarray(0,Z.i),e]),Z.i=X.length,Z),end(e=1){X.writeUInt32BE(Z.i-e,e);let t=X.subarray(0,Z.i);return Z.i=0,X=Buffer.allocUnsafe(256),t}});function ee(e){if(X.length-Z.i<e){let t=X,i=t.length;X=Buffer.allocUnsafe(i+(i>>1)+e),t.copy(X)}}let et=function e(t,i={},{onopen:s=eo,onend:r=eo,onclose:n=eo}={}){let{ssl:o,max:u,user:h,host:d,port:f,database:g,parsers:y,transform:b,onnotice:w,onnotify:v,onparameter:S,max_pipeline:q,keep_alive:T,backoff:N,target_session_attrs:C}=t,$=Y(),_=ei++,A={pid:null,secret:null},P=ep(eJ,t.idle_timeout),x=ep(eJ,t.max_lifetime),E=ep(function(){eR(c.connection("CONNECT_TIMEOUT",t,O)),O.destroy()},t.connect_timeout),O=null,k,Q=new H,L=Buffer.alloc(0),z=t.fetch_types,M={},F={},D=Math.random().toString(36).slice(2),I=1,U=0,R=0,X=0,ee=0,et=0,eu=0,eg=0,em=null,ey=null,eb=!1,ew=null,ev=null,eS=null,eq=null,eT=null,eN=null,eC=null,e$=null,e_=null,eA=null,eP={queue:i.closed,idleTimer:P,connect(e){eS=e,eD()},terminate:eV,execute:eO,cancel:eE,end:eJ,count:0,id:_};return i.closed&&i.closed.push(eP),eP;async function ex(){let e;try{e=t.socket?await Promise.resolve(t.socket(t)):new K.default.Socket}catch(e){eU(e);return}return e.on("error",eU),e.on("close",eW),e.on("drain",ez),e}async function eE({pid:e,secret:t},i,s){try{k=Z().i32(16).i32(0x4d2162e).i32(e).i32(t).end(16),await eF(),O.once("error",s),O.once("close",i)}catch(e){s(e)}}function eO(e){if(eb)return eK(e,c.connection("CONNECTION_DESTROYED",t));if(!e.cancelled)try{return e.state=A,e_?$.push(e):(e_=e).active=!0,function(e){let i=[],s=[],r=m(e,e.strings[0],e.args[0],i,s,t);e.tagged||e.args.forEach(e=>p(e,i,s,t)),e.prepare=t.prepare&&(!("prepare"in e.options)||e.options.prepare),e.string=r,e.signature=e.prepare&&s+r,e.onlyDescribe&&delete F[e.signature],e.parameters=e.parameters||i,e.prepared=e.prepare&&e.signature in F,e.describeFirst=e.onlyDescribe||i.length&&!e.prepared,e.statement=e.prepared?F[e.signature]:{string:r,types:s,name:e.prepare?D+I++:""},"function"==typeof t.debug&&t.debug(_,r,i,s)}(e),ek(function(e){var t;if(e.parameters.length>=65534)throw c.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return e.options.simple?Z().Q().str(e.statement.string+Z.N).end():e.describeFirst?Buffer.concat([eB(e),er]):e.prepare?e.prepared?ej(e):Buffer.concat([eB(e),ej(e)]):(t=e,Buffer.concat([e6(t.statement.string,t.parameters,t.statement.types),el,ej(t)]))}(e))&&!e.describeFirst&&!e.cursorFn&&$.length<q&&(!e.options.onexecute||e.options.onexecute(eP))}catch(e){return 0===$.length&&ek(es),eR(e),!0}}function eB(e){return Buffer.concat([e6(e.statement.string,e.parameters,e.statement.types,e.statement.name),function(e,t=""){return Z().D().str("S").str(t+Z.N).end()}("S",e.statement.name)])}function ej(e){return Buffer.concat([function(e,i,s="",r=""){let n,a;return Z().B().str(r+Z.N).str(s+Z.N).i16(0).i16(e.length),e.forEach((s,r)=>{if(null===s)return Z.i32(0xffffffff);a=i[r],e[r]=s=a in t.serializers?t.serializers[a](s):""+s,n=Z.i,Z.inc(4).str(s).i32(Z.i-n-4,n)}),Z.i16(0),Z.end()}(e.parameters,e.statement.types,e.statement.name,e.cursorName),e.cursorFn?e4("",e.cursorRows):ea])}function ek(e,t){return(eN=eN?Buffer.concat([eN,e]):Buffer.from(e),t||eN.length>=1024)?eQ(t):(null===ey&&(ey=setImmediate(eQ)),!0)}function eQ(e){let t=O.write(eN,e);return null!==ey&&clearImmediate(ey),eN=ey=null,t}async function eL(){if(ek(en),!await new Promise(e=>O.once("data",t=>e(83===t[0])))&&"prefer"===o)return eI();O.removeAllListeners(),(O=J.default.connect({socket:O,servername:K.default.isIP(O.host)?void 0:O.host,..."require"===o||"allow"===o||"prefer"===o?{rejectUnauthorized:!1}:"verify-full"===o?{}:"object"==typeof o?o:{}})).on("secureConnect",eI),O.on("error",eU),O.on("close",eW),O.on("drain",ez)}function ez(){e_||s(eP)}function eM(i){if(!ew||(ew.push(i),!((R-=i.length)>0)))for(L=ew?Buffer.concat(ew,et-R):0===L.length?i:Buffer.concat([L,i],L.length+i.length);L.length>4;){if((et=L.readUInt32BE(1))>=L.length){R=et-L.length,ew=[L];break}try{!function(i,r=i[0]){(68===r?function(e){let t,i,s,r=7,n=e_.isRaw?Array(e_.statement.columns.length):{};for(let a=0;a<e_.statement.columns.length;a++)i=e_.statement.columns[a],t=e.readInt32BE(r),r+=4,s=-1===t?null:!0===e_.isRaw?e.subarray(r,r+=t):void 0===i.parser?e.toString("utf8",r,r+=t):!0===i.parser.array?i.parser(e.toString("utf8",r+1,r+=t)):i.parser(e.toString("utf8",r,r+=t)),e_.isRaw?n[a]=!0===e_.isRaw?s:b.value.from?b.value.from(s,i):s:n[i.name]=b.value.from?b.value.from(s,i):s;e_.forEachFn?e_.forEachFn(b.row.from?b.row.from(n):n,Q):Q[eg++]=b.row.from?b.row.from(n):n}:100===r?function(e){eT&&(eT.push(e.subarray(5))||O.pause())}:65===r?function(e){if(!v)return;let t=9;for(;0!==e[t++];);v(e.toString("utf8",9,t-1),e.toString("utf8",t,e.length-1))}:83===r?function(e){let[i,s]=e.toString("utf8",5,e.length-1).split(Z.N);M[i]=s,t.parameters[i]!==s&&(t.parameters[i]=s,S&&S(i,s))}:90===r?function(i){if(e_&&e_.options.simple&&e_.resolve(ev||Q),e_=ev=null,Q=new H,E.cancel(),eS){if(C)if(M.in_hot_standby&&M.default_transaction_read_only){var r,n;if(r=C,n=M,"read-write"===r&&"on"===n.default_transaction_read_only||"read-only"===r&&"off"===n.default_transaction_read_only||"primary"===r&&"on"===n.in_hot_standby||"standby"===r&&"off"===n.in_hot_standby||"prefer-standby"===r&&"off"===n.in_hot_standby&&t.host[ee])return eV()}else{let e=new l([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],eO,null,{simple:!0});e.resolve=([[e],[t]])=>{M.default_transaction_read_only=e.transaction_read_only,M.in_hot_standby=t.pg_is_in_recovery?"on":"off"},e.execute();return}return z?(eS.reserve&&(eS=null),e2()):(eS&&!eS.reserve&&eO(eS),t.shared.retries=ee=0,void(eS=null))}for(;$.length&&(e_=$.shift())&&(e_.active=!0,e_.cancelled);)e(t).cancel(e_.state,e_.cancelled.resolve,e_.cancelled.reject);e_||(eP.reserved?eP.reserved.release||73!==i[5]?eP.reserved():eq?eV():(eP.reserved=null,s(eP)):eq?eV():s(eP))}:67===r?function(e){eg=0;for(let t=e.length-1;t>0;t--)if(32===e[t]&&e[t+1]<58&&null===Q.count&&(Q.count=+e.toString("utf8",t+1,e.length-1)),e[t-1]>=65){Q.command=e.toString("utf8",5,t),Q.state=A;break}return(eA&&(eA(),eA=null),"BEGIN"!==Q.command||1===u||eP.reserved)?e_.options.simple?eG():void(e_.cursorFn&&(Q.count&&e_.cursorFn(Q),ek(es)),e_.resolve(Q)):eR(c.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"))}:50===r?eG:49===r?function(){e_.parsing=!1}:116===r?function(e){let t=e.readUInt16BE(5);for(let i=0;i<t;++i)e_.statement.types[i]||(e_.statement.types[i]=e.readUInt32BE(7+4*i));e_.prepare&&(F[e_.signature]=e_.statement),e_.describeFirst&&!e_.onlyDescribe&&(ek(ej(e_)),e_.describeFirst=!1)}:84===r?function(e){let t;Q.command&&((ev=ev||[Q]).push(Q=new H),Q.count=null,e_.statement.columns=null);let i=e.readUInt16BE(5),s=7;e_.statement.columns=Array(i);for(let r=0;r<i;++r){for(t=s;0!==e[s++];);let i=e.readUInt32BE(s),n=e.readUInt16BE(s+4),a=e.readUInt32BE(s+6);e_.statement.columns[r]={name:b.column.from?b.column.from(e.toString("utf8",t,s-1)):e.toString("utf8",t,s-1),parser:y[a],table:i,number:n,type:a},s+=18}if(Q.statement=e_.statement,e_.onlyDescribe)return e_.resolve(e_.statement),ek(es)}:82===r?eH:110===r?function(){if(Q.statement=e_.statement,Q.statement.columns=[],e_.onlyDescribe)return e_.resolve(e_.statement),ek(es)}:75===r?function(e){A.pid=e.readUInt32BE(5),A.secret=e.readUInt32BE(9)}:69===r?function(e){var t,i;e_&&(e_.cursorFn||e_.describeFirst)&&ek(es);let s=c.postgres(eh(e));e_&&e_.retried?eR(e_.retried):e_&&e_.prepared&&ec.has(s.routine)?(t=e_,i=s,delete F[t.signature],t.retried=i,eO(t)):eR(s)}:115===r?e3:51===r?function(){Q.count&&e_.cursorFn(Q),e_.resolve(Q)}:71===r?function(){eT=new W.default.Writable({autoDestroy:!0,write(e,t,i){O.write(Z().d().raw(e).end(),i)},destroy(e,t){t(e),O.write(Z().f().str(e+Z.N).end()),eT=null},final(e){O.write(Z().c().end()),eA=e}}),e_.resolve(eT)}:78===r?function(e){w?w(eh(e)):console.log(eh(e))}:72===r?function(){eT=new W.default.Readable({read(){O.resume()}}),e_.resolve(eT)}:99===r?function(){eT&&eT.push(null),eT=null}:73===r?function(){}:86===r?function(){eR(c.notSupported("FunctionCallResponse"))}:118===r?function(){eR(c.notSupported("NegotiateProtocolVersion"))}:87===r?function(){eT=new W.default.Duplex({autoDestroy:!0,read(){O.resume()},write(e,t,i){O.write(Z().d().raw(e).end(),i)},destroy(e,t){t(e),O.write(Z().f().str(e+Z.N).end()),eT=null},final(e){O.write(Z().c().end()),eA=e}}),e_.resolve(eT)}:function(e){console.error("Postgres.js : Unknown Message:",e[0])})(i)}(L.subarray(0,et+1))}catch(e){e_&&(e_.cursorFn||e_.describeFirst)&&ek(es),eR(e)}L=L.subarray(et+1),R=0,ew=null}}async function eF(){if(eb=!1,M={},O||(O=await ex()),O){if(E.start(),t.socket)return o?eL():eI();if(O.on("connect",o?eL:eI),t.path)return O.connect(t.path);O.ssl=o,O.connect(f[X],d[X]),O.host=d[X],O.port=f[X],X=(X+1)%f.length}}function eD(){setTimeout(eF,U?U+eu-G.performance.now():0)}function eI(){try{F={},z=t.fetch_types,D=Math.random().toString(36).slice(2),I=1,x.start(),O.on("data",eM),T&&O.setKeepAlive&&O.setKeepAlive(!0,1e3*T);let e=k||Z().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user:h,database:g,client_encoding:"UTF8"},t.connection)).filter(([,e])=>e).map(([e,t])=>e+Z.N+t).join(Z.N)).z(2).end(0);ek(e)}catch(e){eU(e)}}function eU(e){if(eP.queue!==i.connecting||!t.host[ee+1])for(eR(e);$.length;)eK($.shift(),e)}function eR(e){eT&&(eT.destroy(e),eT=null),e_&&eK(e_,e),eS&&(eK(eS,e),eS=null)}function eK(e,i){if(e.reserve)return e.reject(i);i&&"object"==typeof i||(i=Error(i)),"query"in i||"parameters"in i||Object.defineProperties(i,{stack:{value:i.stack+e.origin.replace(/.*\n/,"\n"),enumerable:t.debug},query:{value:e.string,enumerable:t.debug},parameters:{value:e.parameters,enumerable:t.debug},args:{value:e.args,enumerable:t.debug},types:{value:e.statement&&e.statement.types,enumerable:t.debug}}),e.reject(i)}function eJ(){return eq||(eP.reserved||r(eP),eP.reserved||eS||e_||0!==$.length?eq=new Promise(e=>eC=e):(eV(),new Promise(e=>O&&"closed"!==O.readyState?O.once("close",e):e())))}function eV(){eb=!0,(eT||e_||eS||$.length)&&eU(c.connection("CONNECTION_DESTROYED",t)),clearImmediate(ey),O&&(O.removeListener("data",eM),O.removeListener("connect",eI),"open"===O.readyState&&O.end(Z().X().end())),eC&&(eC(),eq=eC=null)}async function eW(e){if(L=Buffer.alloc(0),R=0,ew=null,clearImmediate(ey),O.removeListener("data",eM),O.removeListener("connect",eI),P.cancel(),x.cancel(),E.cancel(),O.removeAllListeners(),O=null,eS)return eD();!e&&(e_||$.length)&&eU(c.connection("CONNECTION_CLOSED",t,O)),U=G.performance.now(),e&&t.shared.retries++,eu=("function"==typeof N?N(t.shared.retries):N)*1e3,n(eP,c.connection("CONNECTION_CLOSED",t,O))}function eG(){Q.statement||(Q.statement=e_.statement),Q.columns=e_.statement.columns}async function eH(e,t=e.readUInt32BE(5)){(3===t?eY:5===t?eX:10===t?eZ:11===t?e0:12===t?function(e){e.toString("utf8",9).split(Z.N,1)[0].slice(2)!==em&&(eR(c.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),O.destroy())}:0!==t?function(e,t){console.error("Postgres.js : Unknown Auth:",t)}:eo)(e,t)}async function eY(){let e=await e1();ek(Z().p().str(e).z(1).end())}async function eX(e){let t="md5"+await ed(Buffer.concat([Buffer.from(await ed(await e1()+h)),e.subarray(9)]));ek(Z().p().str(t).z(1).end())}async function eZ(){e$=(await V.default.randomBytes(18)).toString("base64"),Z().p().str("SCRAM-SHA-256"+Z.N);let e=Z.i;ek(Z.inc(4).str("n,,n=*,r="+e$).i32(Z.i-e-4,e).end())}async function e0(e){var t;let i=e.toString("utf8",9).split(",").reduce((e,t)=>(e[t[0]]=t.slice(2),e),{}),s=await V.default.pbkdf2Sync(await e1(),Buffer.from(i.s,"base64"),parseInt(i.i),32,"sha256"),r=await ef(s,"Client Key"),n="n=*,r="+e$+",r="+i.r+",s="+i.s+",i="+i.i+",c=biws,r="+i.r;em=(await ef(await ef(s,"Server Key"),n)).toString("base64");let a="c=biws,r="+i.r+",p="+(function(e,t){let i=Math.max(e.length,t.length),s=Buffer.allocUnsafe(i);for(let r=0;r<i;r++)s[r]=e[r]^t[r];return s})(r,Buffer.from(await ef(await (t=r,V.default.createHash("sha256").update(t).digest()),n))).toString("base64");ek(Z().p().str(a).end())}function e1(){return Promise.resolve("function"==typeof t.pass?t.pass():t.pass)}async function e2(){z=!1,(await new l([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],eO)).forEach(({oid:e,typarray:i})=>(function(e,i){if(t.parsers[i]&&t.serializers[i])return;let s=t.parsers[e];t.shared.typeArrayMap[e]=i,t.parsers[i]=e=>(j.i=j.last=0,function e(t,i,s,r){let n=[],a=1020===r?";":",";for(;t.i<i.length;t.i++){if(t.char=i[t.i],t.quoted)"\\"===t.char?t.str+=i[++t.i]:'"'===t.char?(n.push(s?s(t.str):t.str),t.str="",t.quoted='"'===i[t.i+1],t.last=t.i+2):t.str+=t.char;else if('"'===t.char)t.quoted=!0;else if("{"===t.char)t.last=++t.i,n.push(e(t,i,s,r));else if("}"===t.char){t.quoted=!1,t.last<t.i&&n.push(s?s(i.slice(t.last,t.i)):i.slice(t.last,t.i)),t.last=t.i+1;break}else t.char===a&&"}"!==t.p&&'"'!==t.p&&(n.push(s?s(i.slice(t.last,t.i)):i.slice(t.last,t.i)),t.last=t.i+1);t.p=t.char}return t.last<t.i&&n.push(s?s(i.slice(t.last,t.i+1)):i.slice(t.last,t.i+1)),n}(j,e,s,i)),t.parsers[i].array=!0,t.serializers[i]=s=>B(s,t.serializers[e],t,i)})(e,i))}async function e3(){try{let e=await Promise.resolve(e_.cursorFn(Q));eg=0,e===a?ek(function(e=""){return Buffer.concat([Z().C().str("P").str(e+Z.N).end(),Z().S().end()])}(e_.portal)):(Q=new H,ek(e4("",e_.cursorRows)))}catch(e){ek(es),e_.reject(e)}}function e6(e,t,i,s=""){return Z().P().str(s+Z.N).str(e+Z.N).i16(t.length),t.forEach((e,t)=>Z.i32(i[t]||0)),Z.end()}function e4(e="",t=0){return Buffer.concat([Z().E().str(e+Z.N).i32(t).end(),er])}},ei=1,es=Z().S().end(),er=Z().H().end(),en=Z().i32(8).i32(0x4d2162f).end(8),ea=Buffer.concat([Z().E().str(Z.N).i32(0).end(),es]),el=Z().D().str("S").str(Z.N).end(),eo=()=>{},ec=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),eu={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function eh(e){let t={},i=5;for(let s=5;s<e.length-1;s++)0===e[s]&&(t[eu[e[i]]]=e.toString("utf8",i+1,s),i=s+1);return t}function ed(e){return V.default.createHash("md5").update(e).digest("hex")}function ef(e,t){return V.default.createHmac("sha256",e).update(t).digest()}function ep(e,t){let i;if(!(t="function"==typeof t?t():t))return{cancel:eo,start:eo};return{cancel(){i&&(clearTimeout(i),i=null)},start(){i&&clearTimeout(i),i=setTimeout(s,1e3*t,arguments)}};function s(t){e.apply(null,t),i=null}}let eg=()=>{};function em(e,t,i,s){let r,n,a,l=s.raw?Array(t.length):{};for(let o=0;o<t.length;o++)r=e[i++],n=t[o],a=110===r?null:117===r?void 0:void 0===n.parser?e.toString("utf8",i+4,i+=4+e.readUInt32BE(i)):!0===n.parser.array?n.parser(e.toString("utf8",i+5,i+=4+e.readUInt32BE(i))):n.parser(e.toString("utf8",i+4,i+=4+e.readUInt32BE(i))),s.raw?l[o]=!0===s.raw?a:s.value.from?s.value.from(a,n):a:l[n.name]=s.value.from?s.value.from(a,n):a;return{i:i,row:s.row.from?s.row.from(l):l}}function ey(e,t,i=393216){return new Promise(async(s,r)=>{await e.begin(async e=>{let r;t||([{oid:t}]=await e`select lo_creat(-1) as oid`);let[{fd:n}]=await e`select lo_open(${t}, ${i}) as fd`,a={writable:o,readable:l,close:()=>e`select lo_close(${n})`.then(r),tell:()=>e`select lo_tell64(${n})`,read:t=>e`select loread(${n}, ${t}) as data`,write:t=>e`select lowrite(${n}, ${t})`,truncate:t=>e`select lo_truncate64(${n}, ${t})`,seek:(t,i=0)=>e`select lo_lseek64(${n}, ${t}, ${i})`,size:()=>e`
          select
            lo_lseek64(${n}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return s(a),new Promise(async e=>r=e);async function l({highWaterMark:e=16384,start:t=0,end:i=1/0}={}){let s=i-t;return t&&await a.seek(t),new W.default.Readable({highWaterMark:e,async read(e){let t=e>s?e-s:e;s-=e;let[{data:i}]=await a.read(t);this.push(i),i.length<e&&this.push(null)}})}async function o({highWaterMark:e=16384,start:t=0}={}){return t&&await a.seek(t),new W.default.Writable({highWaterMark:e,write(e,t,i){a.write(e).then(()=>i(),i)}})}}).catch(r)})}Object.assign(ew,{PostgresError:o,toPascal:Q,pascal:U,toCamel:k,camel:I,toKebab:L,kebab:R,fromPascal:M,fromCamel:z,fromKebab:F,BigInt:{to:20,from:[20],parse:e=>BigInt(e),serialize:e=>e.toString()}});let eb=ew;function ew(e,s){let r=function(e,i){var s;if(e&&e.shared)return e;let r=process.env,n=(e&&"string"!=typeof e?e:i)||{},{url:a,multihost:l}=function(e){if(!e||"string"!=typeof e)return{url:{searchParams:new Map}};let t=e;t=decodeURIComponent((t=t.slice(t.indexOf("://")+3).split(/[?/]/)[0]).slice(t.indexOf("@")+1));let i=new URL(e.replace(t,t.split(",")[0]));return{url:{username:decodeURIComponent(i.username),password:decodeURIComponent(i.password),host:i.host,hostname:i.hostname,port:i.port,pathname:i.pathname,searchParams:i.searchParams},multihost:t.indexOf(",")>-1&&t}}(e),o=[...a.searchParams].reduce((e,[t,i])=>(e[t]=i,e),{}),c=n.hostname||n.host||l||a.hostname||r.PGHOST||"localhost",u=n.port||a.port||r.PGPORT||5432,h=n.user||n.username||a.username||r.PGUSERNAME||r.PGUSER||function(){try{return t.default.userInfo().username}catch(e){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}();n.no_prepare&&(n.prepare=!1),o.sslmode&&(o.ssl=o.sslmode,delete o.sslmode),"timeout"in n&&(console.log("The timeout option is deprecated, use idle_timeout instead"),n.idle_timeout=n.timeout),"system"===o.sslrootcert&&(o.ssl="verify-full");let d=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],f={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime:eS,max_pipeline:100,backoff:ev,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(c)?c:c.split(",").map(e=>e.split(":")[0]),port:Array.isArray(u)?u:c.split(",").map(e=>parseInt(e.split(":")[1]||u)),path:n.path||c.indexOf("/")>-1&&c+"/.s.PGSQL."+u,database:n.database||n.db||(a.pathname||"").slice(1)||r.PGDATABASE||h,user:h,pass:n.pass||n.password||a.password||r.PGPASSWORD||"",...Object.entries(f).reduce((e,[t,i])=>{let s=t in n?n[t]:t in o?"disable"!==o[t]&&"false"!==o[t]&&o[t]:r["PG"+t.toUpperCase()]||i;return e[t]="string"==typeof s&&d.includes(t)?+s:s,e},{}),connection:{application_name:r.PGAPPNAME||"postgres.js",...n.connection,...Object.entries(o).reduce((e,[t,i])=>(t in f||(e[t]=i),e),{})},types:n.types||{},target_session_attrs:function(e,t,i){let s=e.target_session_attrs||t.searchParams.get("target_session_attrs")||i.PGTARGETSESSIONATTRS;if(!s||["read-write","read-only","primary","standby","prefer-standby"].includes(s))return s;throw Error("target_session_attrs "+s+" is not supported")}(n,a,r),onnotice:n.onnotice,onnotify:n.onnotify,onclose:n.onclose,onparameter:n.onparameter,socket:n.socket,transform:{undefined:(s=n.transform||{undefined:void 0}).undefined,column:{from:"function"==typeof s.column?s.column:s.column&&s.column.from,to:s.column&&s.column.to},value:{from:"function"==typeof s.value?s.value:s.value&&s.value.from,to:s.value&&s.value.to},row:{from:"function"==typeof s.row?s.row:s.row&&s.row.from,to:s.row&&s.row.to}},parameters:{},shared:{retries:0,typeArrayMap:{}},...$(n.types)}}(e,s),n=r.no_subscribe||function(e,t){let i=new Map,s="postgresjs_"+Math.random().toString(36).slice(2),r={},n,a,l=!1,o=h.sql=e({...t,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...t.connection,replication:"database"},onclose:async function(){l||(a=null,r.pid=r.secret=void 0,d(await f(o,s,t.publications)),i.forEach(e=>e.forEach(({onsubscribe:e})=>e())))},no_subscribe:!0}),c=o.end,u=o.close;return o.end=async()=>(l=!0,a&&await new Promise(e=>(a.once("close",e),a.end())),c()),o.close=async()=>(a&&await new Promise(e=>(a.once("close",e),a.end())),u()),h;async function h(e,l,c=eg,u=eg){e=function(e){let[,t,i,s]=e.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];return(t||"*")+(i?":"+(-1===i.indexOf(".")?"public."+i:i):"")+(s?"="+s:"")}(e),n||(n=f(o,s,t.publications));let p={fn:l,onsubscribe:c},g=i.has(e)?i.get(e).add(p):i.set(e,new Set([p])).get(e),m=()=>{g.delete(p),0===g.size&&i.delete(e)};return n.then(e=>(d(e),c(),a&&a.on("error",u),{unsubscribe:m,state:r,sql:o}))}function d(e){a=e.stream,r.pid=e.state.pid,r.secret=e.state.secret}async function f(e,i,s){if(!s)throw Error("Missing publication names");let r=await e.unsafe(`CREATE_REPLICATION_SLOT ${i} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[n]=r,a=await e.unsafe(`START_REPLICATION SLOT ${i} LOGICAL ${n.consistent_point} (proto_version '1', publication_names '${s}')`).writable(),l={lsn:Buffer.concat(n.consistent_point.split("/").map(e=>Buffer.from(("00000000"+e).slice(-8),"hex")))};return a.on("data",function(i){var s,r,n,c,u;119===i[0]?(s=i.subarray(25),r=l,n=e.options.parsers,c=o,u=t.transform,Object.entries({R:e=>{let t=1,i=r[e.readUInt32BE(t)]={schema:e.toString("utf8",t+=4,t=e.indexOf(0,t))||"pg_catalog",table:e.toString("utf8",t+1,t=e.indexOf(0,t+1)),columns:Array(e.readUInt16BE(t+=2)),keys:[]};t+=2;let s=0,a;for(;t<e.length;)(a=i.columns[s++]={key:e[t++],name:u.column.from?u.column.from(e.toString("utf8",t,t=e.indexOf(0,t))):e.toString("utf8",t,t=e.indexOf(0,t)),type:e.readUInt32BE(t+=1),parser:n[e.readUInt32BE(t)],atttypmod:e.readUInt32BE(t+=4)}).key&&i.keys.push(a),t+=4},Y:()=>{},O:()=>{},B:e=>{var t;t=e.readBigInt64BE(9),r.date=new Date(Date.UTC(2e3,0,1)+Number(t/BigInt(1e3))),r.lsn=e.subarray(1,9)},I:e=>{let t=1,i=r[e.readUInt32BE(t)],{row:s}=em(e,i.columns,t+=7,u);c(s,{command:"insert",relation:i})},D:e=>{let t=1,i=r[e.readUInt32BE(t)],s=75===e[t+=4];c(s||79===e[t]?em(e,i.columns,t+=3,u).row:null,{command:"delete",relation:i,key:s})},U:e=>{let t=1,i=r[e.readUInt32BE(t)],s=75===e[t+=4],n=s||79===e[t]?em(e,i.columns,t+=3,u):null;n&&(t=n.i);let{row:a}=em(e,i.columns,t+3,u);c(a,{command:"update",relation:i,key:s,old:n&&n.row})},T:()=>{},C:()=>{}}).reduce((e,[t,i])=>(e[t.charCodeAt(0)]=i,e),{})[s[0]](s)):107===i[0]&&i[17]&&(l.lsn=i.subarray(1,9),function(){let e=Buffer.alloc(34);e[0]=114,e.fill(l.lsn,1),e.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2e3,0,1))*BigInt(1e3),25),a.write(e)}())}),a.on("error",function(e){console.error("Unexpected error during logical streaming - reconnecting",e)}),a.on("close",e.close),{stream:a,state:r.state};function o(e,t){let i=t.relation.schema+"."+t.relation.table;p("*",e,t),p("*:"+i,e,t),t.relation.keys.length&&p("*:"+i+"="+t.relation.keys.map(t=>e[t.name]),e,t),p(t.command,e,t),p(t.command+":"+i,e,t),t.relation.keys.length&&p(t.command+":"+i+"="+t.relation.keys.map(t=>e[t.name]),e,t)}}function p(e,t,s){i.has(e)&&i.get(e).forEach(({fn:i})=>i(t,s,e))}}(ew,{...r}),u=!1,p=Y(),g=Y(),m=Y(),y=Y(),b=Y(),w=Y(),v=Y(),S=Y(),q={connecting:g,reserved:m,closed:y,ended:b,open:w,busy:v,full:S},T=[...Array(r.max)].map(()=>et(r,q,{onopen:D,onend:F,onclose:I})),N=C(function(e){return u?e.reject(c.connection("CONNECTION_ENDED",r,r)):w.length?j(w.shift(),e):y.length?M(y.shift(),e):void(v.length?j(v.shift(),e):p.push(e))});return Object.assign(N,{get parameters(){return r.parameters},largeObject:ey.bind(null,N),subscribe:n,CLOSE:a,END:a,PostgresError:o,options:r,reserve:P,listen:_,begin:E,close:L,end:Q}),N;function C(e){return e.debug=r.debug,Object.entries(r.types).reduce((e,[t,i])=>(e[t]=e=>new d(e,i.to),e),t),Object.assign(s,{types:t,typed:t,unsafe:function(t,i=[],s={}){return 2!=arguments.length||Array.isArray(i)||(s=i,i=[]),new l([t],i,e,k,{prepare:!1,...s,simple:"simple"in s?s.simple:0===i.length})},notify:A,array:function e(t,i){return Array.isArray(t)?new d(t,i||(t.length?x(t)||25:0),r.shared.typeArrayMap):e(Array.from(arguments))},json:B,file:function(t,s=[],r={}){return 2!=arguments.length||Array.isArray(s)||(r=s,s=[]),new l([],s,s=>{i.default.readFile(t,"utf8",(t,i)=>{if(t)return s.reject(t);s.strings=[i],e(s)})},k,{...r,simple:"simple"in r?r.simple:0===s.length})}}),s;function t(e,t){return new d(e,t)}function s(t,...i){return t&&Array.isArray(t.raw)?new l(t,i,e,k):"string"!=typeof t||i.length?new f(t,i):new h(r.transform.column.to?r.transform.column.to(t):t)}}async function _(e,t,i){let s={fn:t,onlisten:i},n=_.sql||(_.sql=ew({...r,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(_.channels).forEach(([e,{listeners:t}])=>{delete _.channels[e],Promise.all(t.map(t=>_(e,t.fn,t.onlisten).catch(()=>{})))})},onnotify(e,t){e in _.channels&&_.channels[e].listeners.forEach(e=>e.fn(t))}})),a=_.channels||(_.channels={});if(e in a){a[e].listeners.push(s);let t=await a[e].result;return s.onlisten&&s.onlisten(),{state:t.state,unlisten:o}}a[e]={result:n`listen ${n.unsafe('"'+e.replace(/"/g,'""')+'"')}`,listeners:[s]};let l=await a[e].result;return s.onlisten&&s.onlisten(),{state:l.state,unlisten:o};async function o(){if(e in a!=!1&&(a[e].listeners=a[e].listeners.filter(e=>e!==s),!a[e].listeners.length))return delete a[e],n`unlisten ${n.unsafe('"'+e.replace(/"/g,'""')+'"')}`}}async function A(e,t){return await N`select pg_notify(${e}, ${""+t})`}async function P(){let e=Y(),t=w.length?w.shift():await new Promise((e,t)=>{let i={reserve:e,reject:t};p.push(i),y.length&&M(y.shift(),i)});O(t,m),t.reserved=()=>e.length?t.execute(e.shift()):O(t,m),t.reserved.release=!0;let i=C(function(i){t.queue===S?e.push(i):t.execute(i)||O(t,S)});return i.release=()=>{t.reserved=null,D(t)},i}async function E(e,t){t||(t=e,e="");let i=Y(),s=0,r,n=null;try{return await N.unsafe("begin "+e.replace(/[^a-z ]/ig,""),[],{onexecute:function(e){r=e,O(e,m),e.reserved=()=>i.length?e.execute(i.shift()):O(e,m)}}).execute(),await Promise.race([a(r,t),new Promise((e,t)=>r.onclose=t)])}catch(e){throw e}async function a(e,t,r){let l,c,u=C(function(t){t.catch(e=>l||(l=e)),e.queue===S?i.push(t):e.execute(t)||O(e,S)});u.savepoint=function t(i,r){return i&&Array.isArray(i.raw)?t(e=>e.apply(e,arguments)):(1==arguments.length&&(r=i,i=null),a(e,r,"s"+s+++(i?"_"+i:"")))},u.prepare=e=>n=e.replace(/[^a-z0-9$-_. ]/gi),r&&await u`savepoint ${u(r)}`;try{if(c=await new Promise((e,i)=>{let s=t(u);Promise.resolve(Array.isArray(s)?Promise.all(s):s).then(e,i)}),l)throw l}catch(e){throw await (r?u`rollback to ${u(r)}`:u`rollback`),e instanceof o&&"25P02"===e.code&&l||e}return r||(n?await u`prepare transaction '${u.unsafe(n)}'`:await u`commit`),c}}function O(e,t){return e.queue.remove(e),t.push(e),e.queue=t,t===w?e.idleTimer.start():e.idleTimer.cancel(),e}function B(e){return new d(e,3802)}function j(e,t){return e.execute(t)?O(e,v):O(e,S)}function k(e){return new Promise((t,i)=>{e.state?e.active?et(r).cancel(e.state,t,i):e.cancelled={resolve:t,reject:i}:(p.remove(e),e.cancelled=!0,e.reject(c.generic("57014","canceling statement due to user request")),t())})}async function Q({timeout:e=null}={}){let t;return u||(await 1,u=Promise.race([new Promise(i=>null!==e&&(t=setTimeout(z,1e3*e,i))),Promise.all(T.map(e=>e.end()).concat(_.sql?_.sql.end({timeout:0}):[],n.sql?n.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(t)))}async function L(){await Promise.all(T.map(e=>e.end()))}async function z(e){for(await Promise.all(T.map(e=>e.terminate()));p.length;)p.shift().reject(c.connection("CONNECTION_DESTROYED",r));e()}function M(e,t){return O(e,g),e.connect(t),e}function F(e){O(e,b)}function D(e){if(0===p.length)return O(e,w);let t=Math.ceil(p.length/(g.length+1)),i=!0;for(;i&&p.length&&t-- >0;){let t=p.shift();if(t.reserve)return t.reserve(e);i=e.execute(t)}i?O(e,v):O(e,S)}function I(e,t){O(e,y),e.reserved=null,e.onclose&&(e.onclose(t),e.onclose=null),r.onclose&&r.onclose(e.id),p.length&&M(e,p.shift())}}function ev(e){return(.5+Math.random()/2)*Math.min(3**e/100,20)}function eS(){return 60*(30+30*Math.random())}var eq=e.i(54892),eT=e.i(41013),eN=e.i(69376),eC=e.i(54850),e$=e.i(29325),e_=e.i(63519),eA=e.i(23951),eP=e.i(90990);class ex{static [eq.entityKind]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if("_"===t)return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===eP.ViewBaseConfig)return{...e[eP.ViewBaseConfig],selectedFields:new Proxy(e[eP.ViewBaseConfig].selectedFields,this)};if("symbol"==typeof t)return e[t];let i=((0,eq.is)(e,eA.Subquery)?e._.selectedFields:(0,eq.is)(e,e_.View)?e[eP.ViewBaseConfig].selectedFields:e)[t];if((0,eq.is)(i,e_.SQL.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!i.isSelectionField)return i.sql;let e=i.clone();return e.isSelectionField=!0,e}if((0,eq.is)(i,e_.SQL)){if("sql"===this.config.sqlBehavior)return i;throw Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return(0,eq.is)(i,e$.Column)?this.config.alias?new Proxy(i,new eC.ColumnAliasProxyHandler(new Proxy(i.table,new eC.TableAliasProxyHandler(this.config.alias,this.config.replaceOriginalName??!1)))):i:"object"!=typeof i||null===i?i:new Proxy(i,new ex(this.config))}}var eE=e.i(66634),eO=e.i(61891),eB=e.i(45257),ej=e.i(16627);class ek{constructor(e,t){this.name=e,this.value=t}static [eq.entityKind]="PgCheckBuilder";brand;build(e){return new eQ(e,this)}}class eQ{constructor(e,t){this.table=e,this.name=t.name,this.value=t.value}static [eq.entityKind]="PgCheck";name;value}e.i(95491),e.i(25669);class eL{constructor(e,t){this.name=e,t&&(this.as=t.as,this.for=t.for,this.to=t.to,this.using=t.using,this.withCheck=t.withCheck)}static [eq.entityKind]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(e){return this._linkedTable=e,this}}e.i(77291),e.i(93012);let ez=Symbol.for("drizzle:PgViewConfig");function eM(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(e=>e.toLowerCase()).join("_")}function eF(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((e,t,i)=>e+(0===i?t.toLowerCase():`${t[0].toUpperCase()}${t.slice(1)}`),"")}function eD(e){return e}class eI{static [eq.entityKind]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert="snake_case"===e?eM:"camelCase"===e?eF:eD}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[eE.Table.Symbol.Schema]??"public",i=e.table[eE.Table.Symbol.OriginalName],s=`${t}.${i}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[eE.Table.Symbol.Schema]??"public",i=e[eE.Table.Symbol.OriginalName],s=`${t}.${i}`;if(!this.cachedTables[s]){for(let t of Object.values(e[eE.Table.Symbol.Columns])){let e=`${s}.${t.name}`;this.cache[e]=this.convert(t.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}}var eU=e.i(16256),eR=e.i(25745),eK=e.i(56475),eJ=e.i(36613),eV=e.i(66392),eW=e.i(20810),eG=e.i(35144),eH=e.i(77286),eY=e.i(62223),eX=e.i(29738),eZ=e.i(8079),e0=e_;class e1 extends e0.View{static [eq.entityKind]="PgViewBase"}class e2{static [eq.entityKind]="PgDialect";casing;constructor(e){this.casing=new eI(e?.casing)}async migrate(e,t,i){let s="string"==typeof i?"__drizzle_migrations":i.migrationsTable??"__drizzle_migrations",r="string"==typeof i?"drizzle":i.migrationsSchema??"drizzle",n=e_.sql`
			CREATE TABLE IF NOT EXISTS ${e_.sql.identifier(r)}.${e_.sql.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(e_.sql`CREATE SCHEMA IF NOT EXISTS ${e_.sql.identifier(r)}`),await t.execute(n);let a=(await t.all(e_.sql`select id, hash, created_at from ${e_.sql.identifier(r)}.${e_.sql.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async t=>{for await(let i of e)if(!a||Number(a.created_at)<i.folderMillis){for(let e of i.sql)await t.execute(e_.sql.raw(e));await t.execute(e_.sql`insert into ${e_.sql.identifier(r)}.${e_.sql.identifier(s)} ("hash", "created_at") values(${i.hash}, ${i.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[e_.sql`with `];for(let[i,s]of e.entries())t.push(e_.sql`${e_.sql.identifier(s._.alias)} as (${s._.sql})`),i<e.length-1&&t.push(e_.sql`, `);return t.push(e_.sql` `),e_.sql.join(t)}buildDeleteQuery({table:e,where:t,returning:i,withList:s}){let r=this.buildWithCTE(s),n=i?e_.sql` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,a=t?e_.sql` where ${t}`:void 0;return e_.sql`${r}delete from ${e}${a}${n}`}buildUpdateSet(e,t){let i=e[eE.Table.Symbol.Columns],s=Object.keys(i).filter(e=>void 0!==t[e]||i[e]?.onUpdateFn!==void 0),r=s.length;return e_.sql.join(s.flatMap((e,s)=>{let n=i[e],a=t[e]??e_.sql.param(n.onUpdateFn(),n),l=e_.sql`${e_.sql.identifier(this.casing.getColumnCasing(n))} = ${a}`;return s<r-1?[l,e_.sql.raw(", ")]:[l]}))}buildUpdateQuery({table:e,set:t,where:i,returning:s,withList:r,from:n,joins:a}){let l=this.buildWithCTE(r),o=e[ej.PgTable.Symbol.Name],c=e[ej.PgTable.Symbol.Schema],u=e[ej.PgTable.Symbol.OriginalName],h=o===u?void 0:o,d=e_.sql`${c?e_.sql`${e_.sql.identifier(c)}.`:void 0}${e_.sql.identifier(u)}${h&&e_.sql` ${e_.sql.identifier(h)}`}`,f=this.buildUpdateSet(e,t),p=n&&e_.sql.join([e_.sql.raw(" from "),this.buildFromTable(n)]),g=this.buildJoins(a),m=s?e_.sql` returning ${this.buildSelection(s,{isSingleTable:!n})}`:void 0,y=i?e_.sql` where ${i}`:void 0;return e_.sql`${l}update ${d} set ${f}${p}${g}${y}${m}`}buildSelection(e,{isSingleTable:t=!1}={}){let i=e.length,s=e.flatMap(({field:e},s)=>{let r=[];if((0,eq.is)(e,e_.SQL.Aliased)&&e.isSelectionField)r.push(e_.sql.identifier(e.fieldAlias));else if((0,eq.is)(e,e_.SQL.Aliased)||(0,eq.is)(e,e_.SQL)){let i=(0,eq.is)(e,e_.SQL.Aliased)?e.sql:e;t?r.push(new e_.SQL(i.queryChunks.map(e=>(0,eq.is)(e,eR.PgColumn)?e_.sql.identifier(this.casing.getColumnCasing(e)):e))):r.push(i),(0,eq.is)(e,e_.SQL.Aliased)&&r.push(e_.sql` as ${e_.sql.identifier(e.fieldAlias)}`)}else(0,eq.is)(e,e$.Column)&&(t?r.push(e_.sql.identifier(this.casing.getColumnCasing(e))):r.push(e));return s<i-1&&r.push(e_.sql`, `),r});return e_.sql.join(s)}buildJoins(e){if(!e||0===e.length)return;let t=[];for(let[i,s]of e.entries()){0===i&&t.push(e_.sql` `);let r=s.table,n=s.lateral?e_.sql` lateral`:void 0,a=s.on?e_.sql` on ${s.on}`:void 0;if((0,eq.is)(r,ej.PgTable)){let e=r[ej.PgTable.Symbol.Name],i=r[ej.PgTable.Symbol.Schema],l=r[ej.PgTable.Symbol.OriginalName],o=e===l?void 0:s.alias;t.push(e_.sql`${e_.sql.raw(s.joinType)} join${n} ${i?e_.sql`${e_.sql.identifier(i)}.`:void 0}${e_.sql.identifier(l)}${o&&e_.sql` ${e_.sql.identifier(o)}`}${a}`)}else if((0,eq.is)(r,e_.View)){let e=r[eP.ViewBaseConfig].name,i=r[eP.ViewBaseConfig].schema,l=r[eP.ViewBaseConfig].originalName,o=e===l?void 0:s.alias;t.push(e_.sql`${e_.sql.raw(s.joinType)} join${n} ${i?e_.sql`${e_.sql.identifier(i)}.`:void 0}${e_.sql.identifier(l)}${o&&e_.sql` ${e_.sql.identifier(o)}`}${a}`)}else t.push(e_.sql`${e_.sql.raw(s.joinType)} join${n} ${r}${a}`);i<e.length-1&&t.push(e_.sql` `)}return e_.sql.join(t)}buildFromTable(e){if((0,eq.is)(e,eE.Table)&&e[eE.Table.Symbol.IsAlias]){let t=e_.sql`${e_.sql.identifier(e[eE.Table.Symbol.OriginalName])}`;return e[eE.Table.Symbol.Schema]&&(t=e_.sql`${e_.sql.identifier(e[eE.Table.Symbol.Schema])}.${t}`),e_.sql`${t} ${e_.sql.identifier(e[eE.Table.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:i,where:s,having:r,table:n,joins:a,orderBy:l,groupBy:o,limit:c,offset:u,lockingClause:h,distinct:d,setOperators:f}){let p,g,m,y=i??(0,eB.orderSelectedFields)(t);for(let e of y){let t;if((0,eq.is)(e.field,e$.Column)&&(0,eE.getTableName)(e.field.table)!==((0,eq.is)(n,eA.Subquery)?n._.alias:(0,eq.is)(n,e1)?n[eP.ViewBaseConfig].name:(0,eq.is)(n,e_.SQL)?void 0:(0,eE.getTableName)(n))&&(t=e.field.table,!a?.some(({alias:e})=>e===(t[eE.Table.Symbol.IsAlias]?(0,eE.getTableName)(t):t[eE.Table.Symbol.BaseName])))){let t=(0,eE.getTableName)(e.field.table);throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let b=!a||0===a.length,w=this.buildWithCTE(e);d&&(p=!0===d?e_.sql` distinct`:e_.sql` distinct on (${e_.sql.join(d.on,e_.sql`, `)})`);let v=this.buildSelection(y,{isSingleTable:b}),S=this.buildFromTable(n),q=this.buildJoins(a),T=s?e_.sql` where ${s}`:void 0,N=r?e_.sql` having ${r}`:void 0;l&&l.length>0&&(g=e_.sql` order by ${e_.sql.join(l,e_.sql`, `)}`),o&&o.length>0&&(m=e_.sql` group by ${e_.sql.join(o,e_.sql`, `)}`);let C="object"==typeof c||"number"==typeof c&&c>=0?e_.sql` limit ${c}`:void 0,$=u?e_.sql` offset ${u}`:void 0,_=e_.sql.empty();if(h){let e=e_.sql` for ${e_.sql.raw(h.strength)}`;h.config.of&&e.append(e_.sql` of ${e_.sql.join(Array.isArray(h.config.of)?h.config.of:[h.config.of],e_.sql`, `)}`),h.config.noWait?e.append(e_.sql` nowait`):h.config.skipLocked&&e.append(e_.sql` skip locked`),_.append(e)}let A=e_.sql`${w}select${p} ${v} from ${S}${q}${T}${m}${N}${g}${C}${$}${_}`;return f.length>0?this.buildSetOperations(A,f):A}buildSetOperations(e,t){let[i,...s]=t;if(!i)throw Error("Cannot pass undefined values to any set operator");return 0===s.length?this.buildSetOperationQuery({leftSelect:e,setOperator:i}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:i}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:i,rightSelect:s,limit:r,orderBy:n,offset:a}}){let l,o=e_.sql`(${e.getSQL()}) `,c=e_.sql`(${s.getSQL()})`;if(n&&n.length>0){let e=[];for(let t of n)if((0,eq.is)(t,eR.PgColumn))e.push(e_.sql.identifier(t.name));else if((0,eq.is)(t,e_.SQL)){for(let e=0;e<t.queryChunks.length;e++){let i=t.queryChunks[e];(0,eq.is)(i,eR.PgColumn)&&(t.queryChunks[e]=e_.sql.identifier(i.name))}e.push(e_.sql`${t}`)}else e.push(e_.sql`${t}`);l=e_.sql` order by ${e_.sql.join(e,e_.sql`, `)} `}let u="object"==typeof r||"number"==typeof r&&r>=0?e_.sql` limit ${r}`:void 0,h=e_.sql.raw(`${t} ${i?"all ":""}`),d=a?e_.sql` offset ${a}`:void 0;return e_.sql`${o}${h}${c}${l}${u}${d}`}buildInsertQuery({table:e,values:t,onConflict:i,returning:s,withList:r,select:n,overridingSystemValue_:a}){let l=[],o=Object.entries(e[eE.Table.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),c=o.map(([,e])=>e_.sql.identifier(this.casing.getColumnCasing(e)));if(n)(0,eq.is)(t,e_.SQL)?l.push(t):l.push(t.getSQL());else for(let[e,i]of(l.push(e_.sql.raw("values ")),t.entries())){let s=[];for(let[e,t]of o){let r=i[e];if(void 0===r||(0,eq.is)(r,e_.Param)&&void 0===r.value)if(void 0!==t.defaultFn){let e=t.defaultFn(),i=(0,eq.is)(e,e_.SQL)?e:e_.sql.param(e,t);s.push(i)}else if(t.default||void 0===t.onUpdateFn)s.push(e_.sql`default`);else{let e=t.onUpdateFn(),i=(0,eq.is)(e,e_.SQL)?e:e_.sql.param(e,t);s.push(i)}else s.push(r)}l.push(s),e<t.length-1&&l.push(e_.sql`, `)}let u=this.buildWithCTE(r),h=e_.sql.join(l),d=s?e_.sql` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,f=i?e_.sql` on conflict ${i}`:void 0,p=!0===a?e_.sql`overriding system value `:void 0;return e_.sql`${u}insert into ${e} ${c} ${p}${h}${f}${d}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:i}){let s=t?e_.sql` concurrently`:void 0,r=i?e_.sql` with no data`:void 0;return e_.sql`refresh materialized view${s} ${e}${r}`}prepareTyping(e){if((0,eq.is)(e,eV.PgJsonb)||(0,eq.is)(e,eJ.PgJson))return"json";if((0,eq.is)(e,eW.PgNumeric))return"decimal";if((0,eq.is)(e,eG.PgTime))return"time";if((0,eq.is)(e,eH.PgTimestamp)||(0,eq.is)(e,eH.PgTimestampString))return"timestamp";if((0,eq.is)(e,eK.PgDate)||(0,eq.is)(e,eK.PgDateString))return"date";else if((0,eq.is)(e,eY.PgUUID))return"uuid";else return"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:s,tableConfig:r,queryConfig:n,tableAlias:a,nestedQueryRelation:l,joinOn:o}){let c,u=[],h,d,f=[],p,g=[];if(!0===n)u=Object.entries(r.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:(0,eC.aliasedTableColumn)(t,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let s=Object.fromEntries(Object.entries(r.columns).map(([e,t])=>[e,(0,eC.aliasedTableColumn)(t,a)]));if(n.where){let e="function"==typeof n.where?n.where(s,(0,eX.getOperators)()):n.where;p=e&&(0,eC.mapColumnsInSQLToAlias)(e,a)}let l=[],o=[];if(n.columns){let e=!1;for(let[t,i]of Object.entries(n.columns))void 0!==i&&t in r.columns&&(e||!0!==i||(e=!0),o.push(t));o.length>0&&(o=e?o.filter(e=>n.columns?.[e]===!0):Object.keys(r.columns).filter(e=>!o.includes(e)))}else o=Object.keys(r.columns);for(let e of o){let t=r.columns[e];l.push({tsKey:e,value:t})}let c=[];if(n.with&&(c=Object.entries(n.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:r.relations[e]}))),n.extras)for(let[e,t]of Object.entries("function"==typeof n.extras?n.extras(s,{sql:e_.sql}):n.extras))l.push({tsKey:e,value:(0,eC.mapColumnsInAliasedSQLToAlias)(t,a)});for(let{tsKey:e,value:t}of l)u.push({dbKey:(0,eq.is)(t,e_.SQL.Aliased)?t.fieldAlias:r.columns[e].name,tsKey:e,field:(0,eq.is)(t,e$.Column)?(0,eC.aliasedTableColumn)(t,a):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let m="function"==typeof n.orderBy?n.orderBy(s,(0,eX.getOrderByOperators)()):n.orderBy??[];for(let{tsKey:s,queryConfig:r,relation:l}of(Array.isArray(m)||(m=[m]),f=m.map(e=>(0,eq.is)(e,e$.Column)?(0,eC.aliasedTableColumn)(e,a):(0,eC.mapColumnsInSQLToAlias)(e,a)),h=n.limit,d=n.offset,c)){let n=(0,eX.normalizeRelation)(t,i,l),o=i[(0,eE.getTableUniqueName)(l.referencedTable)],c=`${a}_${s}`,h=(0,eZ.and)(...n.fields.map((e,t)=>(0,eZ.eq)((0,eC.aliasedTableColumn)(n.references[t],c),(0,eC.aliasedTableColumn)(e,a)))),d=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:i,table:e[o],tableConfig:t[o],queryConfig:(0,eq.is)(l,eX.One)?!0===r?{limit:1}:{...r,limit:1}:r,tableAlias:c,joinOn:h,nestedQueryRelation:l}),f=e_.sql`${e_.sql.identifier(c)}.${e_.sql.identifier("data")}`.as(s);g.push({on:e_.sql`true`,table:new eA.Subquery(d.sql,{},c),alias:c,joinType:"left",lateral:!0}),u.push({dbKey:s,tsKey:s,field:f,relationTableTsKey:o,isJson:!0,selection:d.selection})}}if(0===u.length)throw new eU.DrizzleError({message:`No fields selected for table "${r.tsName}" ("${a}")`});if(p=(0,eZ.and)(o,p),l){let e=e_.sql`json_build_array(${e_.sql.join(u.map(({field:e,tsKey:t,isJson:i})=>i?e_.sql`${e_.sql.identifier(`${a}_${t}`)}.${e_.sql.identifier("data")}`:(0,eq.is)(e,e_.SQL.Aliased)?e.sql:e),e_.sql`, `)})`;(0,eq.is)(l,eX.Many)&&(e=e_.sql`coalesce(json_agg(${e}${f.length>0?e_.sql` order by ${e_.sql.join(f,e_.sql`, `)}`:void 0}), '[]'::json)`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:r.tsName,selection:u}];void 0!==h||void 0!==d||f.length>0?(c=this.buildSelectQuery({table:(0,eC.aliasedTable)(s,a),fields:{},fieldsFlat:[{path:[],field:e_.sql.raw("*")}],where:p,limit:h,offset:d,orderBy:f,setOperators:[]}),p=void 0,h=void 0,d=void 0,f=[]):c=(0,eC.aliasedTable)(s,a),c=this.buildSelectQuery({table:(0,eq.is)(c,ej.PgTable)?c:new eA.Subquery(c,{},a),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:(0,eq.is)(e,e$.Column)?(0,eC.aliasedTableColumn)(e,a):e})),joins:g,where:p,limit:h,offset:d,orderBy:f,setOperators:[]})}else c=this.buildSelectQuery({table:(0,eC.aliasedTable)(s,a),fields:{},fieldsFlat:u.map(({field:e})=>({path:[],field:(0,eq.is)(e,e$.Column)?(0,eC.aliasedTableColumn)(e,a):e})),joins:g,where:p,limit:h,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:r.tsName,sql:c,selection:u}}}class e3{static [eq.entityKind]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class e6{static [eq.entityKind]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t,i=!!this.fields;return t=this.fields?this.fields:(0,eq.is)(e,eA.Subquery)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):(0,eq.is)(e,e1)?e[eP.ViewBaseConfig].selectedFields:(0,eq.is)(e,e_.SQL)?{}:(0,eB.getTableColumns)(e),new e8({table:e,fields:t,isPartialSelect:i,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class e4 extends e3{static [eq.entityKind]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:e,fields:t,isPartialSelect:i,session:s,dialect:r,withList:n,distinct:a}){for(let l of(super(),this.config={withList:n,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=i,this.session=s,this.dialect=r,this._={selectedFields:t,config:this.config},this.tableName=(0,eB.getTableLikeName)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},tg(e)))this.usedTables.add(l)}getUsedTables(){return[...this.usedTables]}createJoin(e,t){return(i,s)=>{let r=this.tableName,n=(0,eB.getTableLikeName)(i);for(let e of tg(i))this.usedTables.add(e);if("string"==typeof n&&this.config.joins?.some(e=>e.alias===n))throw Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof r&&(this.config.fields={[r]:this.config.fields}),"string"==typeof n&&!(0,eq.is)(i,e_.SQL))){let e=(0,eq.is)(i,eA.Subquery)?i._.selectedFields:(0,eq.is)(i,e_.View)?i[eP.ViewBaseConfig].selectedFields:i[eE.Table.Symbol.Columns];this.config.fields[n]=e}if("function"==typeof s&&(s=s(new Proxy(this.config.fields,new ex({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:s,table:i,joinType:e,alias:n,lateral:t}),"string"==typeof n)switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(e,t){return i=>{let s="function"==typeof i?i(e7()):i;if(!(0,eB.haveSameKeys)(this.getSelectedFields(),s.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ex({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new ex({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new ex({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new ex({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),i=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=i:this.config.orderBy=i}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){let t=[];if(t.push(...tg(this.config.table)),this.config.joins)for(let e of this.config.joins)t.push(...tg(e.table));return new Proxy(new eA.Subquery(this.getSQL(),this.config.fields,e,!1,[...new Set(t)]),new ex({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new ex({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(e){return this.cacheConfig=void 0===e?{config:{},enable:!0,autoInvalidate:!0}:!1===e?{enable:!1}:{enable:!0,autoInvalidate:!0,...e},this}}class e8 extends e4{static [eq.entityKind]="PgSelect";_prepare(e){let{session:t,config:i,dialect:s,joinsNotNullableMap:r,authToken:n,cacheConfig:a,usedTables:l}=this;if(!t)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:o}=i;return eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>{let i=(0,eB.orderSelectedFields)(o),c=t.prepareQuery(s.sqlToQuery(this.getSQL()),i,e,!0,void 0,{type:"select",tables:[...l]},a);return c.joinsNotNullableMap=r,c.setToken(n)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>eO.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}function e5(e,t){return(i,s,...r)=>{let n=[s,...r].map(i=>({type:e,isAll:t,rightSelect:i}));for(let e of n)if(!(0,eB.haveSameKeys)(i.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return i.addSetOperators(n)}}(0,eB.applyMixins)(e8,[eN.QueryPromise]);let e7=()=>({union:e9,unionAll:te,intersect:tt,intersectAll:ti,except:ts,exceptAll:tr}),e9=e5("union",!1),te=e5("union",!0),tt=e5("intersect",!1),ti=e5("intersect",!0),ts=e5("except",!1),tr=e5("except",!0);class tn{static [eq.entityKind]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=(0,eq.is)(e,e2)?e:void 0,this.dialectConfig=(0,eq.is)(e,e2)?void 0:e}$with=(e,t)=>{let i=this;return{as:s=>("function"==typeof s&&(s=s(i)),new Proxy(new eA.WithSubquery(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new ex({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(i){return new e6({fields:i??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(e){return new e6({fields:e??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})},selectDistinctOn:function(e,i){return new e6({fields:i??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:e}})}}}select(e){return new e6({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new e6({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new e6({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new e2(this.dialectConfig)),this.dialect}}class ta{constructor(e,t){this.name=e,this.schema=t}static [eq.entityKind]="PgDefaultViewBuilderCore";config={};with(e){return this.config.with=e,this}}class tl extends ta{static [eq.entityKind]="PgViewBuilder";as(e){"function"==typeof e&&(e=e(new tn));let t=new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new td({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class to extends ta{static [eq.entityKind]="PgManualViewBuilder";columns;constructor(e,t,i){super(e,i),this.columns=(0,eB.getTableColumns)((0,ej.pgTable)(e,t))}existing(){return new Proxy(new td({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new td({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class tc{constructor(e,t){this.name=e,this.schema=t}static [eq.entityKind]="PgMaterializedViewBuilderCore";config={};using(e){return this.config.using=e,this}with(e){return this.config.with=e,this}tablespace(e){return this.config.tablespace=e,this}withNoData(){return this.config.withNoData=!0,this}}class tu extends tc{static [eq.entityKind]="PgMaterializedViewBuilder";as(e){"function"==typeof e&&(e=e(new tn));let t=new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),i=new Proxy(e.getSelectedFields(),t);return new Proxy(new tp({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:i,query:e.getSQL().inlineParams()}}),t)}}class th extends tc{static [eq.entityKind]="PgManualMaterializedViewBuilder";columns;constructor(e,t,i){super(e,i),this.columns=(0,eB.getTableColumns)((0,ej.pgTable)(e,t))}existing(){return new Proxy(new tp({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(e){return new Proxy(new tp({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:e.inlineParams()}}),new ex({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class td extends e1{static [eq.entityKind]="PgView";[ez];constructor({pgConfig:e,config:t}){super(t),e&&(this[ez]={with:e.with})}}let tf=Symbol.for("drizzle:PgMaterializedViewConfig");class tp extends e1{static [eq.entityKind]="PgMaterializedView";[tf];constructor({pgConfig:e,config:t}){super(t),this[tf]={with:e?.with,using:e?.using,tablespace:e?.tablespace,withNoData:e?.withNoData}}}function tg(e){return(0,eq.is)(e,ej.PgTable)?[e[eE.Schema]?`${e[eE.Schema]}.${e[eE.Table.Symbol.BaseName]}`:e[eE.Table.Symbol.BaseName]]:(0,eq.is)(e,eA.Subquery)?e._.usedTables??[]:(0,eq.is)(e,e_.SQL)?e.usedTables??[]:[]}class tm extends eN.QueryPromise{constructor(e,t,i,s){super(),this.session=t,this.dialect=i,this.config={table:e,withList:s}}static [eq.entityKind]="PgDelete";config;cacheConfig;where(e){return this.config.where=e,this}returning(e=this.config.table[eE.Table.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=(0,eB.orderSelectedFields)(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"delete",tables:tg(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>eO.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ex({alias:(0,eE.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}var ty=eN;class tb{constructor(e,t,i,s,r){this.table=e,this.session=t,this.dialect=i,this.withList=s,this.overridingSystemValue_=r}static [eq.entityKind]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},i=this.table[eE.Table.Symbol.Columns];for(let s of Object.keys(e)){let r=e[s];t[s]=(0,eq.is)(r,e_.SQL)?r:new e_.Param(r,i[s])}return t});return new tw(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t="function"==typeof e?e(new tn):e;if(!(0,eq.is)(t,e_.SQL)&&!(0,eB.haveSameKeys)(this.table[eE.Columns],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new tw(this.table,t,this.session,this.dialect,this.withList,!0)}}class tw extends ty.QueryPromise{constructor(e,t,i,s,r,n,a){super(),this.session=i,this.dialect=s,this.config={table:e,values:t,withList:r,select:n,overridingSystemValue_:a}}static [eq.entityKind]="PgInsert";config;cacheConfig;returning(e=this.config.table[eE.Table.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=(0,eB.orderSelectedFields)(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=e_.sql`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let i=e.where?e_.sql` where ${e.where}`:void 0;this.config.onConflict=e_.sql`(${e_.sql.raw(t)})${i} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?e_.sql` where ${e.where}`:void 0,i=e.targetWhere?e_.sql` where ${e.targetWhere}`:void 0,s=e.setWhere?e_.sql` where ${e.setWhere}`:void 0,r=this.dialect.buildUpdateSet(this.config.table,(0,eB.mapUpdateSet)(this.config.table,e.set)),n="";return n=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=e_.sql`(${e_.sql.raw(n)})${i} do update set ${r}${t}${s}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:tg(this.config.table)},this.cacheConfig))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>eO.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ex({alias:(0,eE.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}var tv=eN;class tS{constructor(e,t,i,s){this.table=e,this.session=t,this.dialect=i,this.withList=s}static [eq.entityKind]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new tq(this.table,(0,eB.mapUpdateSet)(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}}class tq extends tv.QueryPromise{constructor(e,t,i,s,r){super(),this.session=i,this.dialect=s,this.config={set:t,table:e,withList:r,joins:[]},this.tableName=(0,eB.getTableLikeName)(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [eq.entityKind]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(e){let t=(0,eB.getTableLikeName)(e);return"string"==typeof t&&(this.joinsNotNullableMap[t]=!0),this.config.from=e,this}getTableLikeFields(e){return(0,eq.is)(e,ej.PgTable)?e[eE.Table.Symbol.Columns]:(0,eq.is)(e,eA.Subquery)?e._.selectedFields:e[eP.ViewBaseConfig].selectedFields}createJoin(e){return(t,i)=>{let s=(0,eB.getTableLikeName)(t);if("string"==typeof s&&this.config.joins.some(e=>e.alias===s))throw Error(`Alias "${s}" is already used in this query`);if("function"==typeof i){let e=this.config.from&&!(0,eq.is)(this.config.from,e_.SQL)?this.getTableLikeFields(this.config.from):void 0;i=i(new Proxy(this.config.table[eE.Table.Symbol.Columns],new ex({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),e&&new Proxy(e,new ex({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:i,table:t,joinType:e,alias:s}),"string"==typeof s)switch(e){case"left":this.joinsNotNullableMap[s]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!0;break;case"inner":this.joinsNotNullableMap[s]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[eE.Table.Symbol.Columns]),this.config.from)){let t=(0,eB.getTableLikeName)(this.config.from);if("string"==typeof t&&this.config.from&&!(0,eq.is)(this.config.from,e_.SQL)){let i=this.getTableLikeFields(this.config.from);e[t]=i}for(let t of this.config.joins){let i=(0,eB.getTableLikeName)(t.table);if("string"==typeof i&&!(0,eq.is)(t.table,e_.SQL)){let s=this.getTableLikeFields(t.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=(0,eB.orderSelectedFields)(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0,void 0,{type:"insert",tables:tg(this.config.table)},this.cacheConfig);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new ex({alias:(0,eE.getTableName)(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}var tT=e_;class tN extends tT.SQL{constructor(e){super(tN.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=tN.buildCount(e.source,e.filters)}sql;token;static [eq.entityKind]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return tT.sql`(select count(*) from ${e}${tT.sql.raw(" where ").if(t)}${t})`}static buildCount(e,t){return tT.sql`select count(*) as count from ${e}${tT.sql.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}var tC=eN;class t${constructor(e,t,i,s,r,n,a){this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=r,this.dialect=n,this.session=a}static [eq.entityKind]="PgRelationalQueryBuilder";findMany(e){return new t_(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new t_(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class t_ extends tC.QueryPromise{constructor(e,t,i,s,r,n,a,l,o){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=i,this.table=s,this.tableConfig=r,this.dialect=n,this.session=a,this.config=l,this.mode=o}static [eq.entityKind]="PgRelationalQuery";_prepare(e){return eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:i}=this._toSQL();return this.session.prepareQuery(i,void 0,e,!0,(e,i)=>{let s=e.map(e=>(0,eX.mapRelationalRow)(this.schema,this.tableConfig,e,t.selection,i));return"first"===this.mode?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return eO.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}var tA=eN;class tP extends tA.QueryPromise{constructor(e,t,i,s){super(),this.execute=e,this.sql=t,this.query=i,this.mapBatchResult=s}static [eq.entityKind]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}var tx=eN;class tE extends tx.QueryPromise{constructor(e,t,i){super(),this.session=t,this.dialect=i,this.config={view:e}}static [eq.entityKind]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>eO.tracer.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}class tO{constructor(e,t,i){if(this.dialect=e,this.session=t,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[s,r]of Object.entries(this._.schema))this.query[s]=new t$(i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[s],r,e,t);this.$cache={invalidate:async e=>{}}}static [eq.entityKind]="PgDatabase";query;$with=(e,t)=>{let i=this;return{as:s=>("function"==typeof s&&(s=s(new tn(i.dialect))),new Proxy(new eA.WithSubquery(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new ex({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new tN({source:e,filters:t,session:this.session})}$cache;with(...e){let t=this;return{select:function(i){return new e6({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(i){return new e6({fields:i??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},selectDistinctOn:function(i,s){return new e6({fields:s??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:i}})},update:function(i){return new tS(i,t.session,t.dialect,e)},insert:function(i){return new tb(i,t.session,t.dialect,e)},delete:function(i){return new tm(i,t.session,t.dialect,e)}}}select(e){return new e6({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new e6({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new e6({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new tS(e,this.session,this.dialect)}insert(e){return new tb(e,this.session,this.dialect)}delete(e){return new tm(e,this.session,this.dialect)}refreshMaterializedView(e){return new tE(e,this.session,this.dialect)}authToken;execute(e){let t="string"==typeof e?e_.sql.raw(e):e.getSQL(),i=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(i,void 0,void 0,!1);return new tP(()=>s.execute(void 0,this.authToken),t,i,e=>s.mapResult(e,!0))}transaction(e,t){return this.session.transaction(e,t)}}class tB{static [eq.entityKind]="Cache"}class tj extends tB{strategy(){return"all"}static [eq.entityKind]="NoopCache";async get(e){}async put(e,t,i,s){}async onMutate(e){}}async function tk(e,t){let i=`${e}-${JSON.stringify(t)}`,s=new TextEncoder().encode(i);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",s))].map(e=>e.toString(16).padStart(2,"0")).join("")}class tQ{constructor(e,t,i,s){this.query=e,this.cache=t,this.queryMetadata=i,this.cacheConfig=s,t&&"all"===t.strategy()&&void 0===s&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static [eq.entityKind]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(e,t,i){if(void 0===this.cache||(0,eq.is)(this.cache,tj)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await i()}catch(i){throw new eU.DrizzleQueryError(e,t,i)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[e]=await Promise.all([i(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return e}catch(i){throw new eU.DrizzleQueryError(e,t,i)}if(!this.cacheConfig)try{return await i()}catch(i){throw new eU.DrizzleQueryError(e,t,i)}if("select"===this.queryMetadata.type){let s=await this.cache.get(this.cacheConfig.tag??await tk(e,t),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===s){let s;try{s=await i()}catch(i){throw new eU.DrizzleQueryError(e,t,i)}return await this.cache.put(this.cacheConfig.tag??await tk(e,t),s,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),s}return s}try{return await i()}catch(i){throw new eU.DrizzleQueryError(e,t,i)}}}class tL{constructor(e){this.dialect=e}static [eq.entityKind]="PgSession";execute(e,t){return eO.tracer.startActiveSpan("drizzle.operation",()=>eO.tracer.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){return Number((await this.execute(e,t))[0].count)}}class tz extends tO{constructor(e,t,i,s=0){super(e,t,i),this.schema=i,this.nestedIndex=s}static [eq.entityKind]="PgTransaction";rollback(){throw new eU.TransactionRollbackError}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),e_.sql.raw(t.join(" "))}setTransaction(e){return this.session.execute(e_.sql`set transaction ${this.getTransactionConfigSQL(e)}`)}}class tM extends tQ{constructor(e,t,i,s,r,n,a,l,o,c){super({sql:t,params:i},r,n,a),this.client=e,this.queryString=t,this.params=i,this.logger=s,this.fields=l,this._isResponseInArrayMode=o,this.customResultMapper=c}static [eq.entityKind]="PostgresJsPreparedQuery";async execute(e={}){return eO.tracer.startActiveSpan("drizzle.execute",async t=>{let i=(0,e_.fillPlaceholders)(this.params,e);t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.logger.logQuery(this.queryString,i);let{fields:s,queryString:r,client:n,joinsNotNullableMap:a,customResultMapper:l}=this;if(!s&&!l)return eO.tracer.startActiveSpan("drizzle.driver.execute",()=>this.queryWithCache(r,i,async()=>await n.unsafe(r,i)));let o=await eO.tracer.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":r,"drizzle.query.params":JSON.stringify(i)}),this.queryWithCache(r,i,async()=>await n.unsafe(r,i).values())));return eO.tracer.startActiveSpan("drizzle.mapResponse",()=>l?l(o):o.map(e=>(0,eB.mapResultRow)(s,e,a)))})}all(e={}){return eO.tracer.startActiveSpan("drizzle.execute",async t=>{let i=(0,e_.fillPlaceholders)(this.params,e);return t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.logger.logQuery(this.queryString,i),eO.tracer.startActiveSpan("drizzle.driver.execute",()=>(t?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(i)}),this.queryWithCache(this.queryString,i,async()=>this.client.unsafe(this.queryString,i))))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class tF extends tL{constructor(e,t,i,s={}){super(t),this.client=e,this.schema=i,this.options=s,this.logger=s.logger??new eT.NoopLogger,this.cache=s.cache??new tj}static [eq.entityKind]="PostgresJsSession";logger;cache;prepareQuery(e,t,i,s,r,n,a){return new tM(this.client,e.sql,e.params,this.logger,this.cache,n,a,t,s,r)}query(e,t){return this.logger.logQuery(e,t),this.client.unsafe(e,t).values()}queryObjects(e,t){return this.client.unsafe(e,t)}transaction(e,t){return this.client.begin(async i=>{let s=new tF(i,this.dialect,this.schema,this.options),r=new tD(this.dialect,s,this.schema);return t&&await r.setTransaction(t),e(r)})}}class tD extends tz{constructor(e,t,i,s=0){super(e,t,i,s),this.session=t}static [eq.entityKind]="PostgresJsTransaction";transaction(e){return this.session.client.savepoint(t=>{let i=new tF(t,this.dialect,this.schema,this.session.options);return e(new tD(this.dialect,i,this.schema))})}}class tI extends tO{static [eq.entityKind]="PostgresJsDatabase"}function tU(e,t={}){let i,s,r=e=>e;for(let t of["1184","1082","1083","1114","1182","1185","1115","1231"])e.options.parsers[t]=r,e.options.serializers[t]=r;e.options.serializers["114"]=r,e.options.serializers["3802"]=r;let n=new e2({casing:t.casing});if(!0===t.logger?i=new eT.DefaultLogger:!1!==t.logger&&(i=t.logger),t.schema){let e=(0,eX.extractTablesRelationalConfig)(t.schema,eX.createTableRelationsHelpers);s={fullSchema:t.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}let a=new tF(e,n,s,{logger:i,cache:t.cache}),l=new tI(n,a,s);return l.$client=e,l.$cache=t.cache,l.$cache&&(l.$cache.invalidate=t.cache?.onMutate),l}function tR(...e){if("string"==typeof e[0])return tU(eb(e[0]),e[1]);if((0,eB.isConfig)(e[0])){let{connection:t,client:i,...s}=e[0];if(i)return tU(i,s);if("object"==typeof t&&void 0!==t.url){let{url:e,...i}=t;return tU(eb(e,i),s)}return tU(eb(t),s)}return tU(e[0],e[1])}(tR||(tR={})).mock=function(e){return tU({options:{parsers:{},serializers:{}}},e)},e.i(57354);var tK=e.i(16520);let tJ=process.env.DATABASE_URL;if(!tJ)throw Error("DATABASE_URL environment variable is required");tJ.includes("radbukphijxenmgiljtu")||console.warn("Warning: DATABASE_URL does not point to the Safety database (radbukphijxenmgiljtu)");let tV=tR(eb(tJ,{max:20,idle_timeout:20,connect_timeout:10,ssl:"require"}),{schema:tK,logger:!1})}];

//# sourceMappingURL=%5Broot-of-the-server%5D__12db8bc8._.js.map